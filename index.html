<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Taking Quiz</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    
    <link rel='stylesheet' type='text/css' media='screen' href='/assets/style/main.css'>
    <link rel='stylesheet' type='text/css' media='screen' href='/assets/style/bulma.min.css'>
    <link rel='stylesheet' type='text/css' media='screen' href='/assets/style/all.min.css'>
</head>
<body>
    <div class="contentBox">
        <div class="smallNav section is-flex is-justify-content-space-between is-align-items-center">
            <h1 class="is-size-55 has-text-weight-medium" id="quizName"></h1>
            <a href="/" class="arrow"><i class="fa-solid fa-chevron-right"></i></a>
        </div>

        <div class="section quizBox">
            <div class="columns is-multiline">

                <div class="column is-2 sticksSideBar" id="sticksBox">
                    <div class="burgerIcon">
                        <i class="fas fa-stream" id="showHideSideBar"></i>
                    </div>
                    <div class="sticksSideBarContent" id="sticksContainer">
                        
                    </div>
                </div>
                
                <div class="column quizData" id="quizDataContentBox">
                    <div class="is-flex is-flex-direction-row is-justify-content-space-between is-align-items-center">
                        <span class="tag is-prpl is-small"><span id="point" class="point"></span> degree</span>
                        <span class="time is-size-3" id="time"></span>
                        <span class="has-text-weight-medium is-size-4"><span class="queue" id="nowQueNum">1</span>/<span class="maxera" id="maxQueNum"></span></span>
                    </div>

                    <div class="allQuestionsBox" id="questionContainer">

                    </div>

                    <div class="is-flex is-justify-content-space-between controler buttonato">
                        <button class="button is-prpl prev" id="previousBtn" disabled="true"><i class="fa-solid fa-chevron-left"></i> Previous Question</button>
                        <button class="button is-prpl next" id="nextBtn">Next Question <i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="is-flex is-align-items-center is-justify-content-space-between flexBox">
            <p class="is-size-6 has-text-weight-medium">Made By <a href="https://github.com/HamzaElkotp" class="has-text-purple has-text-weight-semibold is-size-55">Hamza Elkotb</a></p>
            <p class="is-size-55 has-text-weight-medium"><span class="date"></span>&copy; Under <a href="https://github.com/HamzaElkotp/Quiz-Answers_Project/blob/main/LICENSE" class="has-text-purple has-text-weight-semibold">MIT</a> License</p>
            <p class="button is-small is-prpl donate" role="button" id="donate">Donate Me</p>
        </div>
    </footer>
</body>
</html>
<script src='/assets/javascript/main.js'></script>
<script>
    const date = document.querySelector(".date");
    const today = (new Date()).getFullYear();
    date.textContent = today;

    const donateBtn = document.querySelector(".donate");
    donateBtn.addEventListener('click', ()=>{
        window.open("https://www.buymeacoffee.com/HamzaElkotp")
        window.open("https://www.paypal.com/paypalme/dtcHamza")
        window.open("https://www.patreon.com/HamzaElkotb")
    })


    const quizName = document.getElementById("quizName");
    const sticksBox = document.getElementById("sticksBox");
    const showHideSideBar = document.getElementById("showHideSideBar");
    const quizDataContentBox = document.getElementById("showHideSideBar");
    const sticksContainer = document.getElementById("sticksContainer");
    const questionContainer = document.getElementById("questionContainer");

    showHideSideBar?.addEventListener('click', ()=>{
        sticksBox.classList.toggle('hide');
    })


    const point = document.getElementById("point");
    const time = document.getElementById("time");
    const nowQueNum = document.getElementById("nowQueNum");
    const maxQueNum = document.getElementById("maxQueNum");
    const previousBtn = document.getElementById("previousBtn");
    const nextBtn = document.getElementById("nextBtn");







    const composer = function(...funcs){
        return async function(value){
            for(func of funcs){
                value = await func(value)
            }
            return value
        }
    }

    async function fetchQuiz(api){
        let response = await fetch(api);
        let data = await response.json();
        
        if(!response.ok){ return false}
        return data
    }

    const setQuizName = function(data){
        quizName.textContent = data["quizName"];
        return data
    }

    const setTimer = function(data){
        time.textContent = data["timer"];
        return data;
    }


    const loopThroughQuestion = function(data){
        data["questions"].forEach((que)=>{
            pushQuestions(que)
        })
        return data
    }



    const pushSingleQue = function(queData){
        let queParent = document.createElement("div");
        queParent.classList.add("questionHolder");
        queParent.setAttribute("degree", queData["queDegree"]);
        questionContainer.append(queParent);
        return [queData, queParent]
    }
    const pushSingleQueData = function(dataArr){
        let queData = dataArr[0];
        let queParent = dataArr[1];

        let title = document.createElement("p");
        title.textContent = queData["queTitle"];
        title.classList.add("is-size-4", "has-text-weight-semibold");
        queParent.append(title);

        if(queData["queImage"] != ""){
            let img = document.createElement("img");
            img.src = queData["queImage"]
            queParent.append(img);
        }

        let subtitle = document.createElement("p");
        subtitle.textContent = queData["queDetails"];
        subtitle.classList.add("subtitle", "is-size-5", "paragraph");
        queParent.append(subtitle);

        return dataArr
    }
    const pushOptions = function(dataArr){
        let queData = dataArr[0];
        let queParent = dataArr[1];

        let optionsBox = document.createElement("div");
        optionsBox.classList.add("field", "control", "is-flex", "is-flex-direction-column");
        queParent.append(optionsBox);

        let optionBoxNum = queData["queId"];

        queData["queChoices"].forEach(option => {
            let label = document.createElement('label');
            label.classList.add("ans");

            let radio = document.createElement('input');
            radio.type = "radio";
            radio.name = `que${optionBoxNum}`;
            label.append(radio);
            label.append(document.createTextNode(option["optionValue"]));
            optionsBox.append(label);
        });

        return dataArr
    }
    const increaseQueNum = function(dataArr){
        maxQueNum.textContent = Number(maxQueNum.textContent)+1;
        return dataArr
    }
    const createQueStick = function(dataArr){
        let queData = dataArr[0];
        
        let stick = document.createElement("div");
        stick.classList.add("quistion");
        stick.role = "button";
        stick.textContent = `Q${queData["queId"]+1}`

        sticksContainer.append(stick);

        return dataArr
    }


    const startTimer = function(data){

    }

    const pushQuestions = composer(pushSingleQue, pushSingleQueData, pushOptions, increaseQueNum, createQueStick);
    const initQuiz = composer(fetchQuiz, setQuizName, setTimer, loopThroughQuestion)
    initQuiz("/samples/quizTemplate.json")
</script>